<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebVR - Wout Salembier</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.slim.js"></script>
    <script src="/build.js"></script>
    <script>window.NAF || document.write('<script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js">\x3C/script>')</script>
    <script
        src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.min.js"></script>
</head>

<body>
    <a-scene networked-scene="
    app: myApp;
    room: dev;
    debug: true;
    adapter: webrtc;
    " physics antialias="true">
        <a-assets>
            <img id="sky" src="./textures/sky/kk.jpg">
            <img id="ball" src="./textures/ball/balldimpled.png">
            <img id="hoop" src="./textures/ball/test.jpg">
            <img id="box" src="./textures/ball/box.jpg">
            <a-asset id="hand1" src="./textures/hands/rightHandHigh.glb">
                <a-asset id="hand2" src="./textures/hands/leftHandHigh.glb">

                    <a-asset id="tree" src="textures/tree/scene.gltf">
                        <a-asset id="nav-mesh" src="textures/navmesh/navmesh.gltf">

                            <template id="avatar-template">
                                <a-entity scale="0.5 0.5 0.5" class="avatar">
                                    <a-sphere class="head" color="#ffffff" scale="0.45 0.5 0.4"></a-sphere>
                                    <a-entity class="face" position="0 0.05 0">
                                        <a-sphere class="eye" color="#efefef" position="0.16 0.1 -0.35"
                                            scale="0.12 0.12 0.12">
                                            <a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2">
                                            </a-sphere>
                                        </a-sphere>
                                        <a-sphere class="eye" color="#efefef" position="-0.16 0.1 -0.35"
                                            scale="0.12 0.12 0.12">
                                            <a-sphere class="pupil" color="#000" position="0 0 -1" scale="0.2 0.2 0.2">
                                            </a-sphere>
                                        </a-sphere>
                                    </a-entity>
                                </a-entity>
                            </template>

                            <template id="rig-tmp">
                                <a-entity id="rig" position="0 0 0"></a-entity>
                            </template>

                            <template id="rTemp">
                                <a-entity rotation="0 0 0 " position="-1 -1 -1">
                                </a-entity>
                            </template>

                            <template id="lTemp">
                                <a-entity rotaion="0 0 0" position="-1 -1 -1">
                                </a-entity>
                            </template>

                            <template id="handLeft">
                                <a-entity gltf-model="#hand2">
                                </a-entity>
                            </template>


                            <template id="handRight">
                                <a-entity gltf-model="#hand1">
                                </a-entity>
                            </template>





        </a-assets>

        <a-entity id="rig" movement-controls="speed: 0.15; constrainToNavMesh: true"
            networked="template:#rig-tmp; attachTemplateToLocal:false;" position="0 0 0">

            <a-entity id="leftHand" networked="template:#lTemp;" visible="true"
                collision-filter="collisionForces: false" sphere-collider super-hands
                hand-controls="hand: left; handModelStyle: highPoly; color: #34A2BD"
                static-body="shape: sphere; sphereRadius: 0.02;" grab>
                <a-entity visible='false' networked="template:#handLeft;" rotation="0 0 90" class="hand2" gltf-model="#hand2"
                    animation-mixer="loop:  once; clip: Open; clampWhenFinished:  true">
                </a-entity>
            </a-entity>

            <a-entity id="rightHand" networked="template:#rTemp;" visible="true"
                collision-filter="collisionForces: false"
                hand-controls="hand: right; handModelStyle: highPoly; color: #34A2BD" sphere-collider super-hands
                static-body="shape: sphere; sphereRadius: 0.02;" grab>
                <a-entity visible='false' networked="template:#handRight;" networked="template:#handLeft;" rotation="0 0 -90" class="hand1" gltf-model="#hand1"
                    animation-mixer="loop:  once;  clip: Open; clampWhenFinished:  true">
                </a-entity>
            </a-entity>
            <a-entity id="player" camera position="0 1.6 0" look-controls
                networked="template:#avatar-template; attachTemplateToLocal:false;"> </a-entity>
        </a-entity>

        <a-torus position="11.76523 1.65725 -2.44058" scale="" rotation="90 0 0" material="color: #c87d28"
            geometry="radius: 0.29; radiusTubular: 0.02"></a-torus>
        <a-plane src="#hoop" static-body position="11.78556 2.02029 -2.72939" scale="1.4158 1 1" rotation="1 1 1"
            material="side: double" geometry=""></a-plane>
        <a-circle material="color: #3b3a40; side: double;" rotation="90 0 0"
            geometry="radius: 3.56; thetaLength: 360; segments: 36" position="11.72995 0.03 0"></a-circle>
        <a-box static-body color="#4f4f4f" position="11.80985 1.21025 -2.82787" scale="0.16911 2.54358 0.15376"
            geometry="" velocity=""></a-box>

        <a-circle material="color: #3b3a40; side: double; roughness: 0.59" rotation="90 0 0"
            geometry="radius: 3.56; thetaLength: 360; segments: 36" position="-11.86513 0.03 0"></a-circle>

        <a-entity position="0.19192 0 0" rotation="0 180 0">
            <a-entity static-body position="0.32463 1.627 -5.96291" scale="1 1 0.04377"
                text="value: UI - Board; align: center; width: 4.48; lineHeight: 80; side: front;zOffset:0.1"
                geometry="primitive: plane; width: 4.3; height: 1.7" material="side: double; color: #161419">
            </a-entity>
            <a-box static-body color="#4f4f4f" position="-1.86008 1.21025 -5.95909" scale="0.16911 2.54358 0.15376"
                material="" geometry=""></a-box>
            <a-box static-body color="#4f4f4f" position="2.45363 1.21025 -5.95909" scale="0.16911 2.54358 0.15376"
                material="" geometry=""></a-box>
            <a-plane material="color: #1e1820; side: double; roughness: 0.59" position="0.30057 0.0351 -5.52617"
                scale="5.01352 2.86944 1" rotation="90 0 0" geometry="">
            </a-plane>
        </a-entity>

        <a-entity position="-0.34264 0 0" rotation="0 0 0">
            <a-entity static-body position="0.32463 1.627 -5.96291" scale="1 1 0.04377"
                text="value: Hi welcome to your Room! \nGo and explore your created room!\n Enjoy it!; align: center; width: 4.48; lineHeight: 80; side: front; zOffset:0.1"
                geometry="primitive: plane; width: 4.3; height: 1.7" material="side: double; color: #161419">
            </a-entity>
            <a-box static-body color="#4f4f4f" position="-1.86008 1.21025 -5.95909" scale="0.16911 2.54358 0.15376"
                material="" geometry=""></a-box>
            <a-box static-body color="#4f4f4f" position="2.45363 1.21025 -5.95909" scale="0.16911 2.54358 0.15376"
                material="" geometry=""></a-box>
            <a-plane material="color: #1e1820; side: double; roughness: 0.59" position="0.30057 0.0351 -5.52617"
                scale="5.01352 2.86944 1" rotation="90 0 0" geometry="">
            </a-plane>
        </a-entity>

        <a-sphere src="#ball" class="throwable" grabbable dynamic-body="angularDamping: 0.05; " position="13 0.22 -0.5"
            radius="0.14" mass="0.3"></a-sphere>
        <a-sphere src="#ball" class="throwable" grabbable dynamic-body="angularDamping: 0.05; " position="13 1.25 -0.5"
            radius="0.14" mass="0.3"></a-sphere>

        <a-box src="#box" class="throwable" stretchable grabbable dynamic-body="angularDamping: 0.5; "
            position="-11.5 2.25 0" radius="0.50"></a-box>
        <a-box src="#box" class="throwable" stretchable grabbable dynamic-body="angularDamping: 0.5; "
            position="-11.5 0.25 0" radius="0.50"></a-box>

        <a-circle material="color: #1e1820; side: double; roughness: 0.59" open-ended="true" rotation="90 0 0"
            geometry="radius: 5; thetaLength: 460; segments: 360;" position="0 0.01641 0"></a-circle>
        <a-circle material="color: #ec2727; side: double; roughness: 0.59" open-ended="true" rotation="90 0 0"
            geometry="radius: 20; thetaLength: 460; segments: 360;" position=""></a-circle>

        <a-cylinder material="color: #6e19d7; side: double; shader: flat" open-ended="true" rotation=""
            geometry="height: 0.42; radius: 20; segmentsHeight: 17; segmentsRadial: 360; thetaLength: 460" position="">
        </a-cylinder>

        <a-entity id="group-trees">
            <a-entity id="trees" position="">

                <a-entity id="1">
                    <a-entity position="0 0 18.16492" scale="0.005 0.005 0.005"
                        static-body="shape:sphere; sphereRadius:1;" gltf-model="#tree" color="#6e19d7" geometry="">
                    </a-entity>
                    <a-circle material="color: #1e1820; side: double" rotation="90 0 0"
                        geometry="radius: 0.5; thetaLength: 458.77; segments: 20" position="0.01289 0.02363 18.14157">
                    </a-circle>
                </a-entity>

                <a-entity id="2">
                    <a-entity position="-18.87042 0 -0.07932" scale="0.005 0.005 0.005"
                        static-body="shape:sphere; sphereRadius:1;" gltf-model="#tree" color="#6e19d7" geometry="">
                    </a-entity>
                    <a-circle material="color: #1e1820; side: double" rotation="90 0 0"
                        geometry="radius: 0.5; thetaLength: 458.77; segments: 20" position="-18.87042 0.01641 -0.07932">
                    </a-circle>
                </a-entity>

                <a-entity id="3">
                    <a-entity position="17.64445 0 -0.14128" scale="0.005 0.005 0.005"
                        static-body="shape:sphere; sphereRadius:1;" gltf-model="#tree" color="#6e19d7" geometry="">
                    </a-entity>
                    <a-circle material="color: #1e1820; side: double" rotation="90 0 0"
                        geometry="radius: 0.5; thetaLength: 458.77; segments: 20" position="17.64445 0.01641 -0.14128">
                    </a-circle>
                </a-entity>

                <a-entity id="4">
                    <a-entity position="0 0 -18.3363" scale="0.005 0.005 0.005"
                        static-body="shape:sphere; sphereRadius:1;" gltf-model="#tree" color="#6e19d7" geometry="">
                    </a-entity>
                    <a-circle material="color: #1e1820; side: double" rotation="90 0 0"
                        geometry="radius: 0.5; thetaLength: 458.77; segments: 20" position="0.02815 0.01641 -18.3795">
                    </a-circle>
                </a-entity>

            </a-entity>

            <a-entity id="trees" rotation="0 45 0">

                <a-entity id="1">
                    <a-entity position="0 0 18.16492" scale="0.005 0.005 0.005"
                        static-body="shape:sphere; sphereRadius:1;" gltf-model="#tree" color="#6e19d7" geometry="">
                    </a-entity>
                    <a-circle material="color: #1e1820; side: double" rotation="90 0 0"
                        geometry="radius: 0.5; thetaLength: 458.77; segments: 20" position="0.01289 0.02363 18.14157">
                    </a-circle>
                </a-entity>

                <a-entity id="2">
                    <a-entity position="-18.87042 0 -0.07932" scale="0.005 0.005 0.005"
                        static-body="shape:sphere; sphereRadius:1;" gltf-model="#tree" color="#6e19d7" geometry="">
                    </a-entity>
                    <a-circle material="color: #1e1820; side: double" rotation="90 0 0"
                        geometry="radius: 0.5; thetaLength: 458.77; segments: 20" position="-18.87042 0.01641 -0.07932">
                    </a-circle>
                </a-entity>

                <a-entity id="3">
                    <a-entity position="17.64445 0 -0.14128" scale="0.005 0.005 0.005"
                        static-body="shape:sphere; sphereRadius:1;" gltf-model="#tree" color="#6e19d7" geometry="">
                    </a-entity>
                    <a-circle material="color: #1e1820; side: double" rotation="90 0 0"
                        geometry="radius: 0.5; thetaLength: 458.77; segments: 20" position="17.64445 0.01641 -0.14128">
                    </a-circle>
                </a-entity>

                <a-entity id="4">
                    <a-entity position="0 0 -18.3363" scale="0.005 0.005 0.005"
                        static-body="shape:sphere; sphereRadius:1;" gltf-model="#tree" color="#6e19d7" geometry="">
                    </a-entity>
                    <a-circle material="color: #1e1820; side: double" rotation="90 0 0"
                        geometry="radius: 0.5; thetaLength: 458.77; segments: 20" position="0.02815 0.01641 -18.3795">
                    </a-circle>
                </a-entity>

            </a-entity>
        </a-entity>

        <a-box static-body width=100 height=0.001 depth=100 visible="false"></a-box>

        <a-entity visible="false" gltf-model="#nav-mesh" nav-mesh></a-entity>

        <a-plane scale="10 10 1" visible="false" static-body position="0 -0.1 -20.08842" material=""
            geometry="width: 4.24; segmentsHeight: 2; segmentsWidth: 2">
        </a-plane>
        <a-plane scale="10 10 1" visible="false" static-body position="0 -0.1 20.03864" material="side: double"
            geometry="width: 4.24; segmentsHeight: 2; segmentsWidth: 2">
        </a-plane>
        <a-plane scale="10 10 1" visible="false" static-body position="0 -0.1 21.44243" material="side: double"
            geometry="width: 4.24; segmentsHeight: 2; segmentsWidth: 2">
        </a-plane>
        <a-plane scale="10 10 1" visible="false" static-body rotation="0 90 0" position="21.11783 -0.1 0.01573"
            material="side: double" geometry="width: 4.24; segmentsHeight: 2; segmentsWidth: 2">
        </a-plane>

        <a-plane scale="99.84777 98.00598 1" rotation="-90 0 0" roughness="0.1" position="0 -0.1 0"
            material="color: #030311; shader: flat" geometry=""></a-plane>
        <a-sky radius="25" src="#sky" material="" geometry="" rotation="0 55.999999999999996 0"></a-sky>
    </a-scene>

    <script>

        const ANIMATIONS = {
            open: 'Open',
            point: 'Point',
            pointThumb: 'Point + Thumb',
            fist: 'Fist',
            hold: 'Hold',
            thumbUp: 'Thumb Up'
        };
        const rHand = document.querySelector('.hand1');
        const lHand = document.querySelector('.hand2');
        const leftHandController = document.querySelector('#leftHand');
        const rightHandController = document.querySelector('#rightHand');


        leftHandController.addEventListener('pointup', (e) => handsAnimations(lHand, e, ANIMATIONS.hold));
        rightHandController.addEventListener('pointup', (e) => handsAnimations(rHand, e, ANIMATIONS.hold));

        leftHandController.addEventListener('pointdown', (e) => handsAnimations(lHand, e, ANIMATIONS.open));
        rightHandController.addEventListener('pointdown', (e) => handsAnimations(rHand, e, ANIMATIONS.open));

        leftHandController.addEventListener('pistolstart', (e) => handsAnimations(lHand, e, ANIMATIONS.thumbUp));
        rightHandController.addEventListener('pistolstart', (e) => handsAnimations(rHand, e, ANIMATIONS.thumbUp));

        leftHandController.addEventListener('pistolend', (e) => handsAnimations(lHand, e, ANIMATIONS.open));
        rightHandController.addEventListener('pistolend', (e) => handsAnimations(rHand, e, ANIMATIONS.open));

        leftHandController.addEventListener('pointingstart', (e) => handsAnimations(lHand, e, ANIMATIONS.point));
        rightHandController.addEventListener('pointingstart', (e) => handsAnimations(rHand, e, ANIMATIONS.point));

        leftHandController.addEventListener('pointingend', (e) => handsAnimations(lHand, e, ANIMATIONS.open));
        rightHandController.addEventListener('pointingend', (e) => handsAnimations(rHand, e, ANIMATIONS.open));

        leftHandController.addEventListener('gripdown', (e) => handsAnimations(lHand, e, ANIMATIONS.fist));
        rightHandController.addEventListener('gripdown', (e) => handsAnimations(rHand, e, ANIMATIONS.fist));

        leftHandController.addEventListener('gripup', (e) => handsAnimations(lHand, e, ANIMATIONS.open));
        rightHandController.addEventListener('gripup', (e) => handsAnimations(rHand, e, ANIMATIONS.open));

        const handsAnimations = (hand, e, state) => {
            if (e) {
                console.log(e)
                console.log(state)
                hand.setAttribute('animation-mixer', {
                    clip: state
                });

                console.log(hand)
                e.preventDefault()
            }
        };

        NAF.schemas.add({
            template: '#avatar-template',
            components: [
                'position',
                'rotation',
            ]
        });

        NAF.schemas.add({
            template: '#rig-tmp',
            components: [
                'position',
                'rotation',
            ]
        });

        NAF.schemas.add({
            template: '#rTemp',
            components: [
                'position',
                'rotation',
            ]
        });

        NAF.schemas.add({
            template: '#lTemp',
            components: [
                'position',
                'rotation',
            ]
        });

        NAF.schemas.add({
            template: '#handLeft',
            components: [
                'position',
                'rotation',
                'animation-mixer'
            ]
        });

        NAF.schemas.add({
            template: '#handRight',
            components: [
                'position',
                'rotation',
                'animation-mixer'
            ]
        });

        const onConnect = () => {
            console.log("onConnect", new Date());
        }


    </script>
</body>

</html>